<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
	<title>问卷</title>
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<!-- <script src="../../js/vconsole.min.js"></script> -->
	<script src="../../js/html2canvas.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
<style type="text/css">
#vue{
	width: 100%;
	height: 100%;
	position: absolute;
	z-index: 10;
}
</style>
<div class="content">
	<div class="page default-page active" data-path="/"></div>
	<div class="page anime-container" data-path="/anime">
		<div class="anime">
			<img async data-src="images/anime/anime1.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime2.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime3.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime4.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime5.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime6.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime7.gif" />
			<div class="trigger-container">
				<div id="trigger-zone">
					<div></div>
					<div></div>
				</div>
			</div>
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime8.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime9.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime10.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime11.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime12.gif" />
		</div>
		<div class="anime">
			<img async data-src="images/anime/anime13.gif" />
		</div>
	</div>
	<div class="page startTest" data-path="/start">
		<div class="page-bg">
			<img async data-src="images/start/bg.gif" />
		</div>
		<div class="para">
			<img class="para-img" async data-src="images/start/para.png" />
		</div>
		<div class="input-area">
			<input id="username" type="text" maxlength="13" placeholder="签上您的名字接收信件" />
		</div>
		<div class="button-area">
			<input id="enter" type="button" />
			<img  async data-src="images/start/tip.png" />
		</div>
		<div class="tooltip"></div>
	</div>
	<div class="page calculate" data-path="/calculate">
		<img class="page-bg" async data-src="images/calculate/page-bg.png" />
		<img class="loading-bg" async data-src="images/calculate/quietpoint.gif" />
		<img class="sentence" async data-src="images/calculate/shake.png" />
	</div>
	<div class="page sex" data-path="/sex">
		<img class="sex-bg" async data-src="images/sex/bg.png" />
		<div class="sex-item" data-sex="female">
		</div>
		<div class="sex-item" data-sex="male">
		</div>
		<div class="sex-item" data-sex="unknown">
		</div>
	</div>
	<div class="page result active" data-path="/result">
			<img class="page-bg hide" async src="images/result/bg.png" />
			<img class="content-bg" async src="images/result/content_bg.png" />
			<img class="ticket-bg" async src="images/result/ticket_unknown.png" />
			<img class="percept-bg" async src="images/result/percept_2d.png" />
			<img class="conclude-bg" async src="images/result/conclusion_2d_1.png" />
			<span class="username">旅行者bibibobo</span>
	</div>
	<img id="vue" :src="src"/>
</div>
<canvas id="canvas" style="display: none !important;"></canvas>
<script type="text/javascript">
// window.vConsole = new window.VConsole({
//   defaultPlugins: ['system', 'network', 'element', 'storage'], // 可以在此设定要默认加载的面板
//   maxLogNumber: 1000,
//   // disableLogScrolling: true,
//   onReady: function() {
//     console.log('vConsole is ready.');
//   },
//   onClearLog: function() {
//     console.log('on clearLog');
//   }
// });


(function(){
	var body = document.body;
	var inp = document.querySelectorAll('input[data-focus]');
	if(inp.length){
		return;
	}
	var boundRect = body.getBoundingClientRect();
	var maxw = +getComputedStyle(body).maxWidth.slice(0, -2);
	var minw = +getComputedStyle(body).minWidth.slice(0, -2);
	maxw = maxw<=innerWidth ? maxw : innerWidth;
	if(minw >= innerWidth){
		body.style.minWidth = innerWidth + 'px';
		minw = innerWidth;
	}
	var ow = boundRect.width;
	var oh = boundRect.height;
	var nw=maxw, nh=innerHeight;
	if(innerHeight*0.562996 > maxw){
		nw = maxw;
		nh = nw / 0.562996;
	}else if(innerHeight*0.562996 < minw){
		nw = minw;
		nh = nw / 0.562996;
	}else{
		nw = innerHeight * 0.562996;
		nh = innerHeight;
	}
	body.style.width = nw + 'px';
	body.style.height = nh + 'px';
})();

(function(){
	var page = document.querySelector('.page.result.active');
	if(!page){
		return;
	}
	html2canvas(page, {
		'width': page.getBoundingClientRect().width,
		'height': page.getBoundingClientRect().height,
		'useCORS': true,
		'canvas': document.getElementById('canvas')
		// 'foreignObjectRendering': true
	}).then(function(canvas) {
		// var img = new Image();
		// img.onload = function(){
		// 	page.innerHTML = img.outerHTML;
		// 	console.log('生成结果页：');
		// 	// console.log(this.src);
		// }
		// var dataurl = canvas.toDataURL('image/jpeg', 1.0);
		// img.src = dataurl;
		page.innerHTML = '';
		alert(2);
		new Vue({
			el: '#vue',
			data: {
				src: canvas.toDataURL('image/jpeg', 1.0)
			}
		})
	});
})();

</script>
</body>
</html>